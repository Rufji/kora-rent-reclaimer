<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kora Janitor | Operator Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000000; background-image: radial-gradient(at 0% 0%, #1e1a38 0, transparent 50%), radial-gradient(at 100% 0%, #102e26 0, transparent 50%); background-attachment: fixed; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Glassmorphism Card */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Hide Scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="text-gray-300 antialiased min-h-screen pb-10">

    <nav class="border-b border-gray-800 bg-black/80 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-gradient-to-br from-purple-600 to-green-400 flex items-center justify-center text-black font-bold text-lg shadow-lg shadow-purple-900/50">
                    <i class="fa-solid fa-layer-group"></i>
                </div>
                <div>
                    <h1 class="text-lg md:text-xl font-bold text-white tracking-tight leading-none">Kora Janitor</h1>
                    <div class="text-[10px] uppercase tracking-widest text-gray-500">Rent System</div>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <div class="text-right hidden md:block">
                    <div class="text-xs text-gray-500 uppercase">Active Operator</div>
                    <div class="font-mono text-xs text-purple-400"><%= operator %></div>
                </div>
                <div class="md:hidden">
                    <div class="w-2 h-2 rounded-full <%= dryRun ? 'bg-yellow-400' : 'bg-red-500 animate-pulse' %>"></div>
                </div>
                <div class="h-8 w-8 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center text-gray-400 shadow-inner">
                    <i class="fa-solid fa-robot"></i>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-6 px-4">
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            
            <div class="glass-panel rounded-xl p-5 flex items-center justify-between md:block relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 md:opacity-10 opacity-20">
                    <i class="fa-solid fa-server text-4xl md:text-6xl text-white"></i>
                </div>
                <div>
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">System Mode</h3>
                    <% if (dryRun) { %>
                        <div class="flex items-center gap-2 text-yellow-400">
                            <i class="fa-solid fa-flask"></i>
                            <span class="font-bold text-lg">SIMULATION</span>
                        </div>
                    <% } else { %>
                        <div class="flex items-center gap-2 text-red-500">
                            <i class="fa-solid fa-satellite-dish animate-pulse"></i>
                            <span class="font-bold text-lg">LIVE MAINNET</span>
                        </div>
                    <% } %>
                </div>
            </div>

            <div class="glass-panel rounded-xl p-5 flex items-center justify-between md:block">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Analyzed</h3>
                <div class="text-2xl md:text-3xl font-bold text-white font-mono"><%= stats.scanned %></div>
            </div>

            <div class="glass-panel rounded-xl p-5 flex items-center justify-between md:block">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">To Close</h3>
                <div class="text-2xl md:text-3xl font-bold text-white font-mono flex items-center gap-2">
                    <%= stats.reclaimable %>
                    <% if(stats.reclaimable > 0) { %>
                        <span class="text-[10px] md:text-xs bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded-full border border-purple-500/30">Action</span>
                    <% } %>
                </div>
            </div>

            <div class="rounded-xl p-5 bg-gradient-to-br from-gray-900 to-black border border-purple-500/30 shadow-[0_0_15px_rgba(153,69,255,0.1)] flex items-center justify-between md:block">
                <h3 class="text-xs font-bold text-purple-400 uppercase tracking-wider mb-2">Reclaimable Value</h3>
                <div class="flex items-center gap-2 md:gap-3">
                    <img src="https://cryptologos.cc/logos/solana-sol-logo.svg?v=024" class="w-6 h-6 md:w-8 md:h-8" alt="SOL">
                    <span class="text-2xl md:text-3xl font-bold text-white font-mono tracking-tight">
                        <%= (stats.rentValue / 1e9).toFixed(4) %>
                    </span>
                    <span class="text-xs md:text-sm font-bold text-gray-500 mt-2">SOL</span>
                </div>
            </div>
        </div>

        <div class="glass-panel rounded-xl p-4 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-center md:text-left">
                <h4 class="text-white font-bold text-sm"><i class="fa-solid fa-sliders mr-2 text-gray-500"></i>Operations Deck</h4>
                <p class="text-xs text-gray-500 mt-1">Scan first, then verify, then reclaim.</p>
            </div>
            
            <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                <form action="/scan" method="POST" class="w-full md:w-auto">
                    <button type="submit" class="w-full md:w-auto bg-gray-800 active:bg-gray-700 md:hover:bg-gray-700 border border-gray-600 text-white font-semibold py-3 md:py-3 px-6 rounded-lg transition flex items-center justify-center gap-2 group shadow-lg">
                        <i class="fa-solid fa-magnifying-glass text-gray-400 group-hover:text-white transition"></i>
                        <span>Scan History</span>
                    </button>
                </form>

                <form action="/reclaim" method="POST" class="w-full md:w-auto">
                    <% if (stats.reclaimable > 0) { %>
                        <button type="submit" class="w-full md:w-auto bg-gradient-to-r from-purple-600 to-indigo-600 active:from-purple-500 active:to-indigo-500 text-white font-bold py-3 md:py-3 px-8 rounded-lg shadow-lg shadow-purple-900/50 transition transform active:scale-95 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-recycle"></i>
                            <span>Reclaim Funds</span>
                        </button>
                    <% } else { %>
                        <button type="button" disabled class="w-full md:w-auto bg-gray-900 border border-gray-800 text-gray-600 font-bold py-3 md:py-3 px-8 rounded-lg cursor-not-allowed flex items-center justify-center gap-2">
                            <i class="fa-solid fa-ban"></i>
                            <span>No Targets</span>
                        </button>
                    <% } %>
                </form>
            </div>
        </div>

        <div class="glass-panel rounded-xl overflow-hidden border border-gray-800 flex flex-col">
            <div class="px-6 py-4 border-b border-gray-800 bg-black/20 flex justify-between items-center">
                <h4 class="text-sm font-bold text-gray-400 uppercase tracking-widest">Audit Log</h4>
                <div class="text-xs text-gray-600"><i class="fa-solid fa-circle-check mr-1 text-green-500"></i> Online</div>
            </div>

            <div class="overflow-x-auto no-scrollbar">
                <table class="w-full text-left border-collapse min-w-[600px] md:min-w-full">
                    <thead>
                        <tr class="text-xs text-gray-500 border-b border-gray-800 bg-white/5 uppercase tracking-wider">
                            <th class="p-4 font-medium whitespace-nowrap">Account Address</th>
                            <th class="p-4 font-medium whitespace-nowrap">Status</th>
                            <th class="p-4 font-medium whitespace-nowrap">Diagnostic</th>
                            <th class="p-4 font-medium text-right whitespace-nowrap">Locked Rent</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-800 text-sm">
                        <% if (results.length === 0) { %>
                            <tr>
                                <td colspan="4" class="p-12 text-center">
                                    <div class="flex flex-col items-center justify-center text-gray-600">
                                        <i class="fa-regular fa-folder-open text-4xl mb-3 opacity-20"></i>
                                        <p>No scan data available.</p>
                                    </div>
                                </td>
                            </tr>
                        <% } %>
                        
                        <% results.forEach(function(row) { %>
                            <tr class="hover:bg-white/5 transition">
                                <td class="p-4 font-mono text-gray-400">
                                    <div class="flex items-center gap-2">
                                        <i class="fa-solid fa-wallet text-gray-700 text-xs"></i>
                                        <%= row.address.slice(0, 16) %>...
                                    </div>
                                </td>
                                
                                <td class="p-4 whitespace-nowrap">
                                    <% if (row.status === 'RECLAIMED') { %>
                                        <span class="inline-flex items-center gap-1 bg-green-900/30 text-green-400 px-2 py-1 rounded text-xs font-bold border border-green-500/20">
                                            <i class="fa-solid fa-check"></i> RECLAIMED
                                        </span>
                                    <% } else if (row.status === 'READY') { %>
                                        <span class="inline-flex items-center gap-1 bg-yellow-900/30 text-yellow-400 px-2 py-1 rounded text-xs font-bold border border-yellow-500/20 animate-pulse">
                                            <i class="fa-solid fa-triangle-exclamation"></i> READY
                                        </span>
                                    <% } else if (row.status === 'CLOSED') { %>
                                        <span class="inline-flex items-center gap-1 text-gray-500 px-2 py-1 rounded text-xs font-bold">
                                            <i class="fa-solid fa-ban"></i> CLOSED
                                        </span>
                                    <% } else { %>
                                        <span class="inline-flex items-center gap-1 text-gray-600 px-2 py-1 rounded text-xs font-bold">
                                            <i class="fa-solid fa-forward"></i> SKIPPED
                                        </span>
                                    <% } %>
                                </td>
                                
                                <td class="p-4 text-gray-500 whitespace-nowrap"><%= row.reason %></td>
                                
                                <td class="p-4 text-right font-mono whitespace-nowrap">
                                    <div class="flex items-center justify-end gap-2 <%= row.status === 'RECLAIMED' || row.status === 'READY' ? 'text-white' : 'text-gray-600' %>">
                                        <% if (row.lamports > 0) { %>
                                            <img src="https://cryptologos.cc/logos/solana-sol-logo.svg?v=024" class="w-3 h-3 opacity-70" alt="SOL">
                                            <%= (row.lamports / 1e9).toFixed(4) %>
                                        <% } else { %>
                                            -
                                        <% } %>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            
            <div class="p-4 text-center text-xs text-gray-700 bg-black/40">
                <i class="fa-solid fa-shield-halved mr-1"></i> Secure Execution Environment
            </div>
        </div>
    </div>
</body>
</html>